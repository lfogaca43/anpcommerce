Azure na Pratica
azurenapratica@gmail.com
azure@123

Azure SQL
Server Name - anp-commerce-00
Server Admin Login - anp-commerce
Database Name - db-loja-prod
Password - password@123

Azure WebApp
WebApp Name - anp-commerce-prod
App Service Plan - anp-commerce-sp

Storage Account
Account Name - anpcommerce00

Connection Strings
Services:SendMail - https://anp-comm-serverless.azurewebsites.net/api/SendMail
Services:StorageAccount - https://anpcommerce00.blob.core.windows.net/wwwroot
ANPCommerceWebContext - Server=BANCO;Database=db-loja-prod;User id=USUARIO;Password=SENHA
SQL Azure

SEND_GRID_KEY - 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

#r "Newtonsoft.Json"

using System.Net;
using Microsoft.AspNetCore.Mvc;
using Microsoft.Extensions.Primitives;
using Newtonsoft.Json;
using SendGrid;
using SendGrid.Helpers.Mail;

public static async Task<IActionResult> Run(HttpRequest req, ILogger log)
{
    try
    {
        log.LogInformation("Entrou na API de envio de email ativada por um HTTP Trigger.");

        if (req.Method == HttpMethods.Post)
        {
            string requestBody = await new StreamReader(req.Body).ReadToEndAsync();
            ContactModel contactModel = JsonConvert.DeserializeObject<ContactModel>(requestBody);

            var apiKey = Environment.GetEnvironmentVariable("SEND_GRID_KEY");
            var client = new SendGridClient(apiKey);
            var from = new EmailAddress("contato@azurenapratica.com", "Azure na Prática");
            var subject = contactModel.Subject;
            var to = new EmailAddress(contactModel.Email, contactModel.Name);
            var msg = MailHelper.CreateSingleEmail(from, to, subject, contactModel.Message, contactModel.Message);
            var response = await client.SendEmailAsync(msg);

            if(response.StatusCode == System.Net.HttpStatusCode.Accepted)
            {
                return new OkObjectResult($"E-mail enviado com sucesso.");
            }

            return new BadRequestObjectResult("Erro ao enviar email.");
        }
    }
    catch (Exception ex)
    {
        log.LogError(ex, ex.Message);
    }

    return null;    
}

    public class ContactModel
    {
        public string Name { get; set; }
        public string Email { get; set; }
        public string Subject { get; set; }
        public string Message { get; set; }
    }


	function.proj

	<Project Sdk="Microsoft.NET.Sdk">
    <PropertyGroup>
        <TargetFramework>netstandard2.0</TargetFramework>
    </PropertyGroup>

    <ItemGroup>
        <PackageReference Include="Sendgrid" Version="9.12.0" />
    </ItemGroup>
</Project>

Services:StorageAccount - https://anpcommerce00.blob.core.windows.net/wwwroot